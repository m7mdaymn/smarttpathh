<!-- merchant-dashboard.component.html -->
<div class="merchant-dashboard" dir="rtl">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="merchant-info">
        <div class="business-logo">
          <span class="logo-icon">๐ข</span>
        </div>
        <div class="merchant-details">
          <h1>{{ merchantData?.businessName }}</h1>
          <div class="merchant-meta">
            <span class="location">๐ {{ merchantData?.city }}</span>
            <span class="plan-badge" [ngClass]="dashboardStats.plan.toLowerCase()">
              {{ dashboardStats.plan === 'pro' || dashboardStats.plan === 'Pro' ? 'โญ ุจุงูุฉ Pro' : 'ุจุงูุฉ Basic' }}
            </span>
            <span class="subscription-status" [ngClass]="dashboardStats.subscriptionStatus">
              {{ dashboardStats.subscriptionStatus === 'active' ? 'โ ูุดุท' : 'โ ุบูุฑ ูุดุท' }}
            </span>
          </div>
          <div class="subscription-expiry" *ngIf="dashboardStats.subscriptionExpiryDate">
            <span class="expiry-label">ุชูุชูู ูู:</span>
            <span class="expiry-date">{{ dashboardStats.subscriptionExpiryDate | date:'yyyy-MM-dd' }}</span>
          </div>
        </div>
      </div>
      
      <div class="header-actions">
        <button class="action-btn scan-btn" (click)="scanQR()">
          ๐ท ูุณุญ QR
        </button>
        <button class="action-btn settings-btn" (click)="navigateTo('settings')">
          โ๏ธ ุงูุฅุนุฏุงุฏุงุช
        </button>
        <button class="action-btn logout-btn" (click)="logout()">
          ๐ช ุชุณุฌูู ุงูุฎุฑูุฌ
        </button>
      </div>
    </div>
  </header>

  <!-- Quick Stats - Today -->
  <section class="quick-stats">
    <h2 class="section-title">๐ ุฅุญุตุงุฆูุงุช ุงูููู</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">๐ฅ</div>
        <div class="stat-content">
          <h3>ุงูุนููุงุก</h3>
          <p class="stat-value">{{ dashboardStats.totalCustomers }}</p>
          <p class="stat-trend positive">+{{ dashboardStats.newCustomersToday }} ุฌุฏูุฏ ุงูููู</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">๐</div>
        <div class="stat-content">
          <h3>ุบุณูุงุช ุงูููู</h3>
          <p class="stat-value">{{ dashboardStats.washesToday }}</p>
          <p class="stat-trend">{{ getTimeAgo(dashboardStats.lastWashTime) }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">๐ฐ</div>
        <div class="stat-content">
          <h3>ุฅูุฑุงุฏุงุช ุงูููู</h3>
          <p class="stat-value">{{ dashboardStats.todayRevenue | number }}</p>
          <p class="stat-label">ุฑูุงู ุณุนูุฏู</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">๐</div>
        <div class="stat-content">
          <h3>ุงูููุงูุขุช</h3>
          <p class="stat-value">{{ dashboardStats.rewardsGiven }}</p>
          <p class="stat-trend">{{ dashboardStats.pendingRewards }} ููุฏ ุงูุงูุชุธุงุฑ</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Extended Stats - Weekly & Monthly -->
  <section class="extended-stats">
    <h2 class="section-title">๐ ุงูุฅุญุตุงุฆูุงุช ุงูุชูุตูููุฉ</h2>
    <div class="stats-grid extended">
      <div class="stat-card weekly">
        <div class="stat-header">
          <span class="stat-icon">๐</span>
          <h3>ูุฐุง ุงูุฃุณุจูุน</h3>
        </div>
        <div class="stat-body">
          <div class="stat-row">
            <span class="label">ุงูุบุณูุงุช:</span>
            <span class="value">{{ dashboardStats.washesThisWeek }}</span>
          </div>
          <div class="stat-row">
            <span class="label">ุงูุฅูุฑุงุฏุงุช:</span>
            <span class="value highlight">{{ dashboardStats.weeklyRevenue | number }} ุฑูุงู</span>
          </div>
        </div>
      </div>

      <div class="stat-card monthly">
        <div class="stat-header">
          <span class="stat-icon">๐</span>
          <h3>ูุฐุง ุงูุดูุฑ</h3>
        </div>
        <div class="stat-body">
          <div class="stat-row">
            <span class="label">ุงูุบุณูุงุช:</span>
            <span class="value">{{ dashboardStats.washesThisMonth }}</span>
          </div>
          <div class="stat-row">
            <span class="label">ุงูุฅูุฑุงุฏุงุช:</span>
            <span class="value highlight">{{ dashboardStats.monthlyRevenue | number }} ุฑูุงู</span>
          </div>
        </div>
      </div>

      <div class="stat-card total">
        <div class="stat-header">
          <span class="stat-icon">๐</span>
          <h3>ุงูุฅุฌูุงูู</h3>
        </div>
        <div class="stat-body">
          <div class="stat-row">
            <span class="label">ุฅุฌูุงูู ุงูุบุณูุงุช:</span>
            <span class="value">{{ dashboardStats.totalWashesAllTime }}</span>
          </div>
          <div class="stat-row">
            <span class="label">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช:</span>
            <span class="value highlight">{{ dashboardStats.totalRevenueAllTime | number }} ุฑูุงู</span>
          </div>
        </div>
      </div>

    </div>
  </section>
  <!-- Customer Registration QR Section -->
  <section class="registration-qr-section" *ngIf="registrationQR">
    <h2 class="section-title">ุฑูุฒ ุชุณุฌูู ุงูุนููุงุก</h2>
    <div class="qr-card">
      <div class="qr-preview" (click)="openQRModal()">
        <img *ngIf="registrationQR.qrCodeBase64" 
             [src]="registrationQR.qrCodeBase64" 
             alt="ุฑูุฒ QR ููุชุณุฌูู" />
        <div class="qr-overlay">
          <span>ุงุถุบุท ููุชูุจูุฑ</span>
        </div>
      </div>
      <div class="qr-info">
        <div class="code-display">
          <span class="code-label">ููุฏ ุงูุชุณุฌูู:</span>
          <span class="code-value">{{ registrationQR.registrationCode }}</span>
          <button class="copy-btn" (click)="copyRegistrationCode()" title="ูุณุฎ ุงูููุฏ">
            ๐
          </button>
        </div>
        <p class="qr-hint">ูููู ููุนููู ูุณุญ ุฑูุฒ QR ุฃู ุฅุฏุฎุงู ุงูููุฏ ุฃุนูุงู ููุชุณุฌูู</p>
        <div class="qr-actions">
          <button class="secondary-btn" (click)="copyRegistrationUrl()">
            ๐ ูุณุฎ ุฑุงุจุท ุงูุชุณุฌูู
          </button>
          <button class="secondary-btn" (click)="generateNewQRCode()" [disabled]="isLoadingQR">
            ๐ ุชุฌุฏูุฏ ุงูููุฏ
          </button>
        </div>
      </div>
    </div>
  </section>
  <!-- Quick Actions -->
  <section class="quick-actions">
    <h2 class="section-title">ุงูุฅุฌุฑุงุกุงุช ุงูุณุฑูุนุฉ</h2>
    <div class="actions-grid">

      <button class="action-card" (click)="viewCustomers()">
        <div class="action-icon">๐ฅ</div>
        <h3>ุงูุนููุงุก</h3>
        <p>ุฅุฏุงุฑุฉ ูุงุฆูุฉ ุงูุนููุงุก</p>
      </button>

      <button class="action-card" (click)="scanQR()">
        <div class="action-icon">๐ท</div>
        <h3>ูุณุญ QR</h3>
        <p>ุณุฌู ุบุณูุฉ ุฌุฏูุฏุฉ</p>
      </button>

      <button class="action-card qr-action" (click)="openQRModal()">
        <div class="action-icon">๐ฑ</div>
        <h3>ุฑูุฒ ุงูุชุณุฌูู</h3>
        <p>ุฑุงุจุท ุชุณุฌูู ุงูุนููุงุก</p>
      </button>

      <!-- <button class="action-card" (click)="viewReports()">
        <div class="action-icon">๐</div>
        <h3>ุงูุชูุงุฑูุฑ</h3>
        <p>ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช</p>
      </button> -->
    </div>
  </section>

  <!-- Loyalty Status -->
  <section class="loyalty-status">
    <h2 class="section-title">ุญุงูุฉ ุงูููุงุก</h2>
    <div class="loyalty-card">
      <div class="loyalty-header">
        <h3>ุฅุนุฏุงุฏุงุช ุจุฑูุงูุฌ ุงูููุงุก</h3>
        <button class="edit-btn" (click)="navigateTo('settings')">ุชุนุฏูู</button>
      </div>
      
      <div class="loyalty-details">
        <div class="detail">
          <span class="label">ุงูููุงูุฃุฉ:</span>
          <span class="value">{{ loyaltySettings.rewardName }}</span>
        </div>
        <div class="detail">
          <span class="label">ุงูุบุณูุงุช ุงููุทููุจุฉ:</span>
          <span class="value">{{ loyaltySettings.washesRequired }}</span>
        </div>
        <div class="detail">
          <span class="label">ุงููุฏุฉ:</span>
          <span class="value">{{ loyaltySettings.timePeriod }} ููู</span>
        </div>
      </div>
    </div>
  </section>


  <!-- Recent Activity -->
  <section class="recent-activity">
    <div class="section-header">
      <h2 class="section-title">ุงููุดุงุท ุงูุฃุฎูุฑ</h2>
      <button class="view-all" (click)="viewAllActivity()">ุนุฑุถ ุงููู โ</button>
    </div>

    <div class="activity-list">
      <div class="activity-item" *ngFor="let activity of recentActivity">
        <div class="activity-icon" [ngClass]="activity.type">
          <span>{{ activity.type === 'wash' ? '๐' : 
                   activity.type === 'customer' ? '๐ค' : 
                   activity.type === 'reward' ? '๐' : '๐ฐ' }}</span>
        </div>
        <div class="activity-content">
          <h4>{{ activity.title }}</h4>
          <p>{{ activity.description }}</p>
          <span class="activity-time">{{ activity.time }}</span>
        </div>
      </div>
    </div>
  </section>


  <!-- QR Modal -->
  <div class="qr-modal-overlay" *ngIf="showQRModal" (click)="closeQRModal()">
    <div class="qr-modal" (click)="$event.stopPropagation()">
      <button class="modal-close" (click)="closeQRModal()">โ</button>
      <h3>ุฑูุฒ ุชุณุฌูู ุงูุนููุงุก</h3>
      <div class="modal-qr-image">
        <img *ngIf="registrationQR?.qrCodeBase64 || registrationQR?.qrCodeImage" 
             [src]="registrationQR?.qrCodeBase64 || registrationQR?.qrCodeImage" 
             alt="ุฑูุฒ QR ููุชุณุฌูู" />
        <div *ngIf="!registrationQR?.qrCodeBase64 && !registrationQR?.qrCodeImage" style="padding: 40px; text-align: center; background: #f5f5f5; border-radius: 8px;">
          <p>ุฌุงุฑู ุชุญููู ุฑูุฒ QR...</p>
        </div>
      </div>
      <div class="modal-code">
        <span class="code-label">ููุฏ ุงูุชุณุฌูู:</span>
        <span class="code-value large">{{ registrationQR?.registrationCode }}</span>
      </div>
      <p class="modal-hint">ุงุทูุจ ูู ุงูุนููู ูุณุญ ุงูุฑูุฒ ุฃู ุฅุฏุฎุงู ุงูููุฏ ููุชุณุฌูู ูู ูุบุณูุชู</p>
      <div class="modal-actions">
        <button class="primary-btn" (click)="copyRegistrationCode()">๐ ูุณุฎ ุงูููุฏ</button>
        <button class="primary-btn" (click)="copyRegistrationUrl()">๐ ูุณุฎ ุงูุฑุงุจุท</button>
      </div>
    </div>
  </div>
</div>