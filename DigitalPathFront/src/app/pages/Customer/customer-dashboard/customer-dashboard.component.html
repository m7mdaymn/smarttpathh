<!-- customer-dashboard.component.html -->
<div class="customer-dashboard" dir="rtl">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-container">
      <div class="user-section">
        <div class="user-info">
          <h1 class="user-greeting">ุงููุง ุจุนูุฏุชู , {{ user.name }}</h1>
          <div class="user-details">
            <span class="phone">ุฌุงูุฒ ูุชุณุฌูู ุบุณูุฉ ุฌุฏูุฏุฉ</span>
          </div>
        </div>
      </div>
      <div class="header-actions">
        <button class="notification-bell-btn" (click)="toggleNotificationModal()" title="ุงูุฅุดุนุงุฑุงุช">
          <span class="bell-icon">๐</span>
          <span class="notification-badge" *ngIf="unreadNotificationsCount > 0">{{ unreadNotificationsCount }}</span>
        </button>
        <button class="logout-btn" (click)="logout()">
          ุชุณุฌูู ุงูุฎุฑูุฌ
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <div class="dashboard-grid">
      <!-- Left Column: Loyalty Cards & Profile -->
      <div class="dashboard-column">
        <!-- Profile Section -->
        <section class="profile-section">
          <div class="section-header">
            <h2>ุงูููู ุงูุดุฎุตู</h2>
          </div>
          <div class="profile-card">
            <div class="profile-info">
              <div class="info-item">
                <span class="label">ุงูุงุณู ุงููุงูู</span>
                <span class="value">{{ user.name }}</span>
              </div>
              <div class="info-item">
                <span class="label">ุฑูู ุงููุงุชู</span>
                <span class="value">{{ user.phone }}</span>
              </div>
              <div class="info-item">
                <span class="label">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</span>
                <span class="value">{{ user.email }}</span>
              </div>
              <div class="info-item">
                <span class="label">ุฑูู ุงูููุญุฉ</span>
                <span class="value">{{ user.carPlate }}</span>
              </div>
            </div>
            
            <!-- Car Photo Section - Only show when merchant allows -->
            <div class="car-photo-section" *ngIf="canUploadCarPhoto()">
              <div class="section-header">
                <h3>ุตูุฑุฉ ุงูุณูุงุฑุฉ</h3>
                <small class="feature-badge">ููุฒุฉ ุงุญุชุฑุงููุฉ</small>
              </div>
              
              <!-- Active state (when merchant allows) -->
              <div class="car-photo-container">
                <!-- Show photo with Add button below it -->
                <div class="current-photo" *ngIf="user.carPhoto">
                  <img [src]="user.carPhoto" alt="Car Photo" class="car-photo">
                  <!-- Only show Add button, not Change button -->
                  <button class="add-photo-btn" (click)="uploadCarPhoto()" *ngIf="!hasUploadedPhoto">
                    + ุฅุถุงูุฉ ุตูุฑุฉ
                  </button>
                </div>
                
                <!-- Show upload area when no photo exists -->
                <div class="upload-photo" *ngIf="!user.carPhoto">
                  <div class="upload-placeholder" (click)="uploadCarPhoto()">
                    <span class="upload-icon">๐ท</span>
                    <span class="upload-text">ุฅุถุงูุฉ ุตูุฑุฉ ุงูุณูุงุฑุฉ</span>
                    <span class="upload-hint">(ูุฑุฉ ูุงุญุฏุฉ ููุท)</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Loyalty Cards Section -->
        <section class="loyalty-section">
          <div class="section-header">
            <h2>ุจุทุงูุงุช ุงูููุงุก</h2>
            <button class="show-qr-btn" (click)="openLoyaltyQRModal()">
              ๐ฑ ุนุฑุถ ุฑูุฒ QR ููุบุณูู
            </button>
          </div>
          <div class="loyalty-cards-container">
            <div *ngFor="let card of loyaltyCards" class="loyalty-card">
              <div class="card-header">
                <div class="merchant-info">
                  <h3>{{ card.merchantName }}</h3>
                  <div class="merchant-details">
                    <span class="location">๐ {{ card.merchantLocation }}</span>
                  </div>
                </div>
                <div class="card-status">
                  <span class="status-badge" [class.active]="card.isActive">
                    {{ card.isActive ? 'ูุดุท' : 'ุบูุฑ ูุดุท' }}
                  </span>
                </div>
              </div>
              
              <!-- Progress Section - ALWAYS VISIBLE -->
              <div class="progress-section">
                <!-- Car Wash Icons Row -->
                <div class="wash-icons-row">
                  <!-- Completed Wash Icons -->
                  <div *ngFor="let icon of getCompletedWashIcons(card)" 
                       class="wash-icon completed">
                    <div class="car-icon">๐</div>
                    <div class="soap-bubbles">๐ซง</div>
                  </div>
                  
                  <!-- Remaining Wash Icons -->
                  <div *ngFor="let icon of getRemainingWashIcons(card)" 
                       class="wash-icon remaining">
                    <div class="car-icon">๐</div>
                  </div>
                </div>
                
                <!-- Text Below Icons -->
                <div class="progress-text-row">
                  <div class="text-column">
                    <div class="small-text">ุงููุชุจูู ุญุชู ุงูููุงูุฃุฉ</div>
                    <div class="large-bold">{{ getRemainingWashes(card) }} ุบุณููุงุช</div>
                  </div>
                  <div class="text-column">
                    <div class="small-text">ุงูููุงูุฃุฉ</div>
                    <div class="large-bold">{{ card.rewardDescription || 'ููุงูุฃุฉ' }}</div>
                  </div>
                </div>
                
                <!-- Bottom QR Code -->
                <div class="wash-qr-section">
                  <div class="qr-code white-qr" (click)="openLoyaltyQRModal()">
                    <div class="qr-placeholder" *ngIf="!customerQRCode">
                      <span class="qr-text">QR</span>
                    </div>
                    <img *ngIf="customerQRCode" [src]="customerQRCode" alt="Customer QR Code" class="qr-image" />
                    <p class="qr-hint">{{ user.customerQRCode || 'DP-CUST-...' }}</p>
                  </div>
                  
                  <!-- Export to Wallet Button -->
                  <button class="export-wallet-btn" (click)="exportToWallet(card)" title="ุฅุถุงูุฉ ุฅูู ุงููุญูุธุฉ">
                    <span class="wallet-icon">๐ฒ</span>
                    <span class="wallet-text">ุฅุถุงูุฉ ูููุญูุธุฉ</span>
                  </button>
                </div>
              </div>
              
              <!-- Reward Section (for redeemable rewards) -->
              <div *ngIf="card.isRewardAchievable" class="reward-section">
                <div class="achievable-section">
                  <button class="show-reward-qr-btn" (click)="showRewardQRForCard(card)">
                    <span class="qr-icon">๐</span>
                    ุนุฑุถ ููุฏ ุงูููุงูุฃุฉ
                  </button>
                  <p class="qr-hint">ูุฐุง ุงูููุฏ ุตุงูุญ ูุงุณุชูุงู ุงูููุงูุฃุฉ: {{ card.rewardDescription }}</p>
                </div>
              </div>
              
              <!-- Progress Summary -->
              <div class="progress-summary">
                <div class="summary-item">
                  <span class="summary-label">ุฅุฌูุงูู ุงูุบุณูุงุช:</span>
                  <span class="summary-value">{{ card.totalWashesWithMerchant || 0 }}</span>
                </div>
                <div class="summary-item" *ngIf="card.lastWashDate">
                  <span class="summary-label">ุขุฎุฑ ุฒูุงุฑุฉ:</span>
                  <span class="summary-value">{{ card.lastWashDate }}</span>
                </div>
                <div class="summary-item" *ngIf="card.daysRemaining">
                  <span class="summary-label">ุฃูุงู ูุชุจููุฉ:</span>
                  <span class="summary-value">{{ card.daysRemaining }} ููู</span>
                </div>
              </div>
            </div>
            
            <div *ngIf="loyaltyCards.length === 0" class="empty-cards">
              <div class="empty-icon">๐</div>
              <h4>ูุง ุชูุฌุฏ ุจุทุงูุงุช ููุงุก</h4>
              <p>ูู ุจุฒูุงุฑุฉ ุงูุชุงุฌุฑ ููุญุตูู ุนูู ุจุทุงูุฉ ููุงุก</p>
            </div>
          </div>
        </section>
      </div>

      <!-- Right Column: Rewards & History -->
      <div class="dashboard-column">
        <!-- Rewards Status -->
        <section class="rewards-section">
          <div class="section-header">
            <h2>ุญุงูุฉ ุงูููุงูุขุช</h2>
          </div>
          
          <!-- Rewards Tabs -->
          <div class="rewards-tabs">
            <button class="tab-btn" 
                    [class.active]="rewardsTab === 'available'"
                    (click)="setRewardsTab('available')">
              ูุชุงุญุฉ ({{ availableRewardsCount }})
            </button>
            <button class="tab-btn" 
                    [class.active]="rewardsTab === 'claimed'"
                    (click)="setRewardsTab('claimed')">
              ูุณุชุฎุฏูุฉ ({{ claimedRewardsCount }})
            </button>
            <button class="tab-btn" 
                    [class.active]="rewardsTab === 'expired'"
                    (click)="setRewardsTab('expired')">
              ููุชููุฉ ({{ expiredRewardsCount }})
            </button>
          </div>
          
          <div class="rewards-container">
            <div *ngFor="let reward of filteredRewards" class="reward-card">
              <div class="reward-header">
                <div class="reward-icon">{{ getRewardIcon(reward.type) }}</div>
                <div class="reward-info">
                  <h4>{{ reward.title }}</h4>
                  <p class="merchant-name">{{ reward.merchantName }}</p>
                </div>
                <span class="reward-status-badge" [class]="reward.status">
                  {{ getRewardStatusText(reward.status) }}
                </span>
              </div>
              
              <div class="reward-content">
                <p class="reward-description">{{ reward.description }}</p>
                
                <div class="reward-details">
                  <span class="expiry">๐ ุญุชู: {{ formatDate(reward.expiresAt) }}</span>
                  <span class="value" *ngIf="reward.value > 0">{{ reward.value }} ุฑ.ุณ</span>
                </div>
              </div>
              
              <div class="reward-actions" *ngIf="reward.status === 'available' && !reward.isExpired">
                <button class="show-qr-btn" (click)="showRewardQR(reward)">
                  ๐ฑ ุนุฑุถ ููุฏ QR
                </button>
              </div>
              
              <div *ngIf="reward.status === 'claimed' && reward.claimedAt" class="used-info">
                <span class="used-icon">โ</span>
                <span>ุชู ุงูุงุณุชุฎุฏุงู: {{ formatDate(reward.claimedAt) }}</span>
              </div>
            </div>
            
            <div *ngIf="filteredRewards.length === 0" class="empty-rewards">
              <div class="empty-icon">
                {{ getEmptyIcon() }}
              </div>
              <h4>{{ getEmptyTitle() }}</h4>
              <p>{{ getEmptyMessage() }}</p>
            </div>
          </div>
        </section>

        <!-- Wash History -->
        <section class="history-section">
          <div class="section-header">
            <h2>ุณุฌู ุงูุบุณูุงุช</h2>
            <span class="wash-count" *ngIf="washHistory.length > 0">{{ washHistory.length }} ุบุณูุงุช</span>
          </div>
          <div class="history-container">
            <div class="history-list">
              <div *ngFor="let wash of washHistory; let i = index" class="history-item" [class.first-item]="i === 0">
                <div class="wash-info">
                  <div class="wash-header">
                    <div class="date-time">
                      <span class="wash-date">{{ wash.date }}</span>
                      <span class="wash-time">{{ wash.time }}</span>
                    </div>
                    <span class="wash-status" [class.completed]="wash.status === 'completed'" 
                          [class.pending]="wash.status === 'pending'"
                          [class.cancelled]="wash.status === 'cancelled'">
                      {{ wash.status === 'completed' ? 'โ ููุชููุฉ' : wash.status === 'pending' ? 'โณ ููุฏ ุงูุชูููุฐ' : 'โ ููุบูุฉ' }}
                    </span>
                  </div>
                  <div class="wash-merchant">
                    <span class="merchant-name">{{ wash.merchantName }}</span>
                  </div>
                  <div class="wash-services" *ngIf="wash.washType">
                    <span class="service-icon">๐</span>
                    <span class="service-name">{{ wash.washType }}</span>
                  </div>
                  <div class="wash-notes" *ngIf="wash.notes">
                    <span class="notes-label">ููุงุญุธุงุช:</span>
                    <span class="notes-text">{{ wash.notes }}</span>
                  </div>
                </div>
                <div class="wash-price-section">
                  <span class="wash-price">{{ wash.price }} ุฑ.ุณ</span>
                  <span class="discount-badge" *ngIf="wash.discountApplied && wash.discountApplied > 0">
                    ุฎุตู {{ wash.discountApplied }} ุฑ.ุณ
                  </span>
                  <div class="rating-section">
                    <div class="rating-stars" *ngIf="wash.rating">
                      <span *ngFor="let star of [1,2,3,4,5]" class="star" [class.filled]="star <= wash.rating!">โ</span>
                    </div>
                    <button class="rate-btn" *ngIf="!wash.rating && wash.status === 'completed'" (click)="openRatingModal(wash)">
                      โญ ูููู
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <div *ngIf="washHistory.length === 0" class="empty-history">
              <div class="empty-icon">๐</div>
              <h4>ูุง ุชูุฌุฏ ุบุณูุงุช ูุณุฌูุฉ</h4>
              <p>ูู ุจุฒูุงุฑุฉ ุฃุญุฏ ูุบุงุณู ุงูุณูุงุฑุงุช ููุจุฏุก ูู ุฌูุน ุงูุทูุงุจุน</p>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- DUAL QR MODALS -->
  
  <!-- Loyalty QR Modal (Customer QR for washing) -->
  <div *ngIf="showLoyaltyQRModal" class="qr-modal" (click)="closeLoyaltyQRModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ุฑูุฒ QR ููุบุณูู</h3>
        <button class="close-btn" (click)="closeLoyaltyQRModal()">โ</button>
      </div>
      <div class="modal-body">
        <div class="qr-display">
          <!-- Car Photo Section (if available) -->
          <div class="car-photo-modal-section" *ngIf="user.carPhoto">
            <div class="car-photo-container-modal">
              <img [src]="user.carPhoto" alt="ุตูุฑุฉ ุงูุณูุงุฑุฉ" class="car-photo-modal" />
            </div>
            <p class="car-photo-label">๐ ุตูุฑุฉ ุณูุงุฑุชู</p>
          </div>
          
          <div class="qr-code-container loyalty-qr">
            <div class="qr-code">
              <img *ngIf="customerQRCode" 
                   [src]="customerQRCode" 
                   alt="Customer QR Code" 
                   class="qr-image" />
              <div *ngIf="!customerQRCode" class="qr-placeholder">
                <span class="qr-text">{{ generateFallbackQR() }}</span>
              </div>
            </div>
            <p class="qr-instruction">ุฃุธูุฑ ูุฐุง ุงูุฑูุฒ ููุชุงุฌุฑ ุนูุฏ ุงูุบุณูู ููุณุจ ุงูุฎุชู</p>
            <p class="qr-purpose">๐ ูุฐุง ุงูููุฏ ูุถูู ุฎุชู ูุจุทุงูุชู</p>
          </div>
          
          <div class="user-info-modal">
            <div class="info-item">
              <span class="label">ุงูุงุณู:</span>
              <span class="value">{{ user.name }}</span>
            </div>
            <div class="info-item">
              <span class="label">ุฑูู ุงูุณูุงุฑุฉ:</span>
              <span class="value">{{ user.carPlate }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reward QR Modal (For redeeming rewards) -->
  <div *ngIf="showRewardQRModal" class="qr-modal reward-modal" (click)="closeRewardQRModal()">
    <div class="modal-content reward-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header reward-header">
        <h3>๐ ููุฏ ุงุณุชุจุฏุงู ุงูููุงูุฃุฉ</h3>
        <button class="close-btn" (click)="closeRewardQRModal()">โ</button>
      </div>
      <div class="modal-body reward-body" *ngIf="selectedReward">
        <!-- Instruction Header -->
        <div class="reward-instruction">
          <p class="instruction-text">๐ ุฃุธูุฑ ูุฐุง ุงูููุฏ ูููุงุดูุฑ ูุงุณุชูุงู ุงูููุงูุฃุฉ</p>
        </div>
        
        <!-- QR Code Display -->
        <div class="qr-display reward-qr-display">
          <div class="qr-code-container reward-qr-container">
            <div class="qr-code reward-qr-code">
              <!-- Use API to generate QR image from text code -->
              <img *ngIf="selectedReward.qrCode" 
                   [src]="getRewardQRImageUrl(selectedReward.qrCode)" 
                   alt="Reward QR Code" 
                   class="qr-image reward-qr-image"
                   (error)="onQRImageError($event)" />
              <!-- Fallback when image fails or no QR code -->
              <div class="qr-fallback-text" [style.display]="selectedReward.qrCode ? 'none' : 'flex'">
                <span class="qr-code-label">ููุฏ ุงูููุงูุฃุฉ:</span>
                <span class="qr-text">{{ selectedReward.qrCode || generateRewardCode(selectedReward) }}</span>
              </div>
            </div>
            <p class="qr-code-text" *ngIf="selectedReward.qrCode">{{ selectedReward.qrCode }}</p>
          </div>
        </div>
        
        <!-- Warning -->
        <div class="reward-warning">
          <span class="warning-icon">โ๏ธ</span>
          <span class="warning-text">ูุฐุง ุงูููุฏ ููุงุณุชุจุฏุงู ููุท - ูุง ุชุดุงุฑูู ูุน ุฃุญุฏ</span>
        </div>
          
        <!-- Reward Details Section -->
        <div class="reward-details-section">
          <div class="detail-row">
            <span class="detail-icon">๐</span>
            <span class="detail-label">ููุน ุงูููุงูุฃุฉ:</span>
            <span class="detail-value highlight">{{ selectedReward.title || 'ุบุณูุฉ ูุฌุงููุฉ' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-icon">๐ช</span>
            <span class="detail-label">ุงููุบุณูุฉ:</span>
            <span class="detail-value">{{ selectedReward.merchantName }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-icon">๐</span>
            <span class="detail-label">ุชูุชูู ุงูุตูุงุญูุฉ:</span>
            <span class="detail-value" [class.expiry-warning]="selectedReward.daysUntilExpiry <= 3">
              {{ formatDate(selectedReward.expiresAt) }}
              <span *ngIf="selectedReward.daysUntilExpiry <= 3" class="expiry-badge">
                {{ selectedReward.daysUntilExpiry === 0 ? 'ุงูููู!' : 'ุฎูุงู ' + selectedReward.daysUntilExpiry + ' ุฃูุงู' }}
              </span>
            </span>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Car Photo Upload Modal -->
  <div *ngIf="showPhotoUploadModal" class="photo-modal" (click)="closePhotoUploadModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ุฑูุน ุตูุฑุฉ ุงูุณูุงุฑุฉ</h3>
        <button class="close-btn" (click)="closePhotoUploadModal()">โ</button>
      </div>
      <div class="modal-body">
        <div class="upload-area" (click)="triggerFileUpload()">
          <span class="upload-icon">๐ท</span>
          <p>ุงููุฑ ูุงุฎุชูุงุฑ ุตูุฑุฉ ุงูุณูุงุฑุฉ</p>
          <p class="upload-note">(ูููู ุฑูุน ุงูุตูุฑุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท)</p>
        </div>
        <input type="file" #fileInput style="display: none;" accept="image/*" (change)="onFileSelected($event)">
      </div>
    </div>
  </div>

  <!-- Wallet Export Modal -->
  <div *ngIf="showWalletExportModal && selectedCardForExport" class="qr-modal wallet-modal" (click)="closeWalletExportModal()">
    <div class="modal-content wallet-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header wallet-header">
        <h3>๐ฒ ุฅุถุงูุฉ ุฅูู ุงููุญูุธุฉ</h3>
        <button class="close-btn" (click)="closeWalletExportModal()">โ</button>
      </div>
      <div class="modal-body wallet-body">
        <!-- Card Preview -->
        <div class="wallet-card-preview">
          <div class="preview-card">
            <div class="preview-merchant">{{ selectedCardForExport.merchantName }}</div>
            <div class="preview-progress">
              <span class="progress-label">ุงูุชูุฏู:</span>
              <span class="progress-value">{{ selectedCardForExport.currentStamps }} / {{ selectedCardForExport.requiredStamps }}</span>
            </div>
            <div class="preview-reward">{{ selectedCardForExport.rewardDescription }}</div>
          </div>
        </div>

        <!-- Export Options -->
        <div class="wallet-export-options">
          <button class="export-option-btn download-btn" (click)="downloadCardImage(selectedCardForExport)">
            <span class="option-icon">๐พ</span>
            <span class="option-text">
              <strong>ุชุญููู ุตูุฑุฉ ุงูุจุทุงูุฉ</strong>
              <small>ุงุญูุธูุง ูู ูุนุฑุถ ุงูุตูุฑ ูููุตูู ุงูุณุฑูุน</small>
            </span>
          </button>
          
          <button class="export-option-btn qr-btn" (click)="openLoyaltyQRModal(); closeWalletExportModal()">
            <span class="option-icon">๐ฑ</span>
            <span class="option-text">
              <strong>ุนุฑุถ ุฑูุฒ QR</strong>
              <small>ุงูุณุญ ุงูุฑูุฒ ูุฅุถุงูุชู ูุฏููุงู ูููุญูุธุฉ</small>
            </span>
          </button>
        </div>

        <!-- Instructions -->
        <div class="wallet-instructions">
          <h4>๐ ุชุนูููุงุช ุงูุฅุถุงูุฉ ุงููุฏููุฉ</h4>
          <div class="instruction-tabs">
            <div class="instruction-item">
              <span class="device-icon">๐</span>
              <div class="instruction-content">
                <strong>iPhone (Apple Wallet)</strong>
                <p>ุงูุชุญ ุชุทุจูู ุงููุงููุฑุง โ ูุฌููุง ูุญู ุฑูุฒ QR โ ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ</p>
              </div>
            </div>
            <div class="instruction-item">
              <span class="device-icon">๐ค</span>
              <div class="instruction-content">
                <strong>Android (Google Wallet)</strong>
                <p>ุงูุชุญ Google Wallet โ ุงุถุบุท "ุฅุถุงูุฉ" โ ุงูุณุญ ุฑูุฒ QR</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rating Modal -->
  <div *ngIf="showRatingModal && selectedWashForRating" class="qr-modal rating-modal" (click)="closeRatingModal()">
    <div class="modal-content rating-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>โญ ุชูููู ุงูุบุณูุฉ</h3>
        <button class="close-btn" (click)="closeRatingModal()">โ</button>
      </div>
      <div class="modal-body rating-body">
        <div class="rating-wash-info">
          <p class="wash-merchant-name">{{ selectedWashForRating.merchantName }}</p>
          <p class="wash-date-info">{{ selectedWashForRating.date }} - {{ selectedWashForRating.washType }}</p>
        </div>
        
        <div class="rating-stars-input">
          <p class="rating-label">ููู ูุงูุช ุชุฌุฑุจุชูุ</p>
          <div class="stars-container">
            <span *ngFor="let star of [1,2,3,4,5]" 
                  class="star-input" 
                  [class.selected]="star <= selectedRating"
                  [class.hover]="star <= hoverRating"
                  (click)="setRating(star)"
                  (mouseenter)="hoverRating = star"
                  (mouseleave)="hoverRating = 0">
              โ
            </span>
          </div>
          <p class="rating-hint" *ngIf="selectedRating > 0">
            {{ getRatingText(selectedRating) }}
          </p>
        </div>

        <div class="rating-comment">
          <label for="ratingComment">ุชุนููู (ุงุฎุชูุงุฑู):</label>
          <textarea id="ratingComment" 
                    [(ngModel)]="ratingComment" 
                    placeholder="ุงูุชุจ ุชุนูููู ููุง..."
                    rows="3"></textarea>
        </div>

        <div class="rating-actions">
          <button class="submit-rating-btn" 
                  [disabled]="selectedRating === 0 || isSubmittingRating"
                  (click)="submitRating()">
            {{ isSubmittingRating ? 'ุฌุงุฑู ุงูุฅุฑุณุงู...' : 'ุฅุฑุณุงู ุงูุชูููู' }}
          </button>
          <button class="cancel-rating-btn" (click)="closeRatingModal()">ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Modal -->
  <div *ngIf="showNotificationModal" class="qr-modal notification-modal" (click)="closeNotificationModal()">
    <div class="modal-content notification-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>๐ ุงูุฅุดุนุงุฑุงุช</h3>
        <div class="modal-header-actions">
          <button *ngIf="unreadNotificationsCount > 0" class="mark-all-read-btn" (click)="markAllAsRead()">
            ุชุญุฏูุฏ ุงููู ูููุฑูุก
          </button>
          <button class="close-btn" (click)="closeNotificationModal()">โ</button>
        </div>
      </div>
      <div class="modal-body notification-body">
        <div class="notification-list" *ngIf="notifications.length > 0">
          <div *ngFor="let notification of notifications" 
               class="notification-item"
               [class.unread]="!notification.read"
               (click)="markAsRead(notification)">
            <div class="notification-icon">{{ notification.icon }}</div>
            <div class="notification-content">
              <p class="notification-title">{{ notification.title }}</p>
              <p class="notification-message">{{ notification.message }}</p>
              <span class="notification-date">{{ notification.date }}</span>
            </div>
          </div>
        </div>
        <div class="empty-notifications" *ngIf="notifications.length === 0">
          <div class="empty-icon">๐</div>
          <h4>ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช</h4>
          <p>ุณุชุธูุฑ ููุง ุฅุดุนุงุฑุงุชู ุนูุฏ ุญุตููู ุนูู ููุงูุขุช ุฃู ุชุณุฌูู ุบุณูุงุช</p>
        </div>
      </div>
    </div>
  </div>
</div>